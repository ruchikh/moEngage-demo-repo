{"ast":null,"code":"var _s = $RefreshSig$();\n/* eslint-disable import/no-extraneous-dependencies */\nimport { useEffect, useState } from \"react\";\nimport { Capacitor } from \"@capacitor/core\";\nimport { PushNotifications } from \"@capacitor/push-notifications\";\nimport { MoECapacitorCore } from \"capacitor-moengage-core\";\nimport { EventPathMapping } from \"../eventPathMapping\";\nconst useNotifications = () => {\n  _s();\n  const [fcmToken, setFcmToken] = useState({});\n  const addListeners = async () => {\n    await PushNotifications.addListener(\"registration\", async token => {\n      setFcmToken(token);\n      console.info(\"Registration token: \", token.value);\n    });\n    await PushNotifications.addListener(\"registrationError\", err => {\n      console.error(\"Registration error: \", err.error);\n    });\n    await PushNotifications.addListener(\"pushNotificationReceived\", notification => {\n      console.log(\"Push notification received: \", notification);\n    });\n    await PushNotifications.addListener(\"pushNotificationActionPerformed\", ({\n      notification\n    }) => {\n      window.open(EventPathMapping(notification.data.event, notification.data));\n    });\n  };\n  useEffect(() => {\n    if (Capacitor.isNativePlatform()) {\n      const permStatus = PushNotifications.checkPermissions();\n      MoECapacitorCore.pushPermissionResponseAndroid({\n        isGranted: permStatus.receive === \"granted\"\n      });\n      if (permStatus.receive === \"granted\") {\n        MoECapacitorCore.passFcmPushToken({\n          token: fcmToken,\n          //frm token should be added here\n          appId: \"Q5YBYJOT6NU535WZD1JVOIDV\"\n        });\n        MoECapacitorCore.setupNotificationChannelsAndroid();\n        MoECapacitorCore.requestPushPermissionAndroid();\n      } else {\n        MoECapacitorCore.navigateToSettingsAndroid();\n      }\n    }\n  }, [fcmToken]);\n  const registerNotifications = async () => {\n    let permStatus = await PushNotifications.checkPermissions();\n    if (permStatus.receive === \"prompt\") {\n      permStatus = await PushNotifications.requestPermissions();\n    }\n    if (permStatus.receive !== \"granted\") {\n      throw new Error(\"User denied permissions!\");\n    }\n    await PushNotifications.register();\n  };\n  const getDeliveredNotifications = async () => {\n    const notificationList = await PushNotifications.getDeliveredNotifications();\n    console.log(\"delivered notifications\", notificationList);\n  };\n  const enablePushNotifications = () => {\n    if (Capacitor.isNativePlatform()) {\n      addListeners();\n      registerNotifications();\n      getDeliveredNotifications();\n    }\n  };\n  return enablePushNotifications;\n};\n_s(useNotifications, \"Up+EEYpJIsyWBIdoQ2tBCz2hTfQ=\");\nexport default useNotifications;","map":{"version":3,"names":["useEffect","useState","Capacitor","PushNotifications","MoECapacitorCore","EventPathMapping","useNotifications","_s","fcmToken","setFcmToken","addListeners","addListener","token","console","info","value","err","error","notification","log","window","open","data","event","isNativePlatform","permStatus","checkPermissions","pushPermissionResponseAndroid","isGranted","receive","passFcmPushToken","appId","setupNotificationChannelsAndroid","requestPushPermissionAndroid","navigateToSettingsAndroid","registerNotifications","requestPermissions","Error","register","getDeliveredNotifications","notificationList","enablePushNotifications"],"sources":["/Users/ruchi/Documents/work/vegrow-repo/moengage-demo-app/src/hooks/useNotifications.js"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nimport { useEffect, useState } from \"react\";\nimport { Capacitor } from \"@capacitor/core\";\nimport { PushNotifications } from \"@capacitor/push-notifications\";\nimport { MoECapacitorCore } from \"capacitor-moengage-core\";\n\nimport { EventPathMapping } from \"../eventPathMapping\";\n\nconst useNotifications = () => {\n  const [fcmToken, setFcmToken] = useState({});\n  const addListeners = async () => {\n    await PushNotifications.addListener(\"registration\", async (token) => {\n      setFcmToken(token);\n      console.info(\"Registration token: \", token.value);\n    });\n\n    await PushNotifications.addListener(\"registrationError\", (err) => {\n      console.error(\"Registration error: \", err.error);\n    });\n\n    await PushNotifications.addListener(\n      \"pushNotificationReceived\",\n      (notification) => {\n        console.log(\"Push notification received: \", notification);\n      }\n    );\n\n    await PushNotifications.addListener(\n      \"pushNotificationActionPerformed\",\n      ({ notification }) => {\n        window.open(\n          EventPathMapping(notification.data.event, notification.data)\n        );\n      }\n    );\n  };\n\n  useEffect(() => {\n    if (Capacitor.isNativePlatform()) {\n      const permStatus = PushNotifications.checkPermissions();\n\n      MoECapacitorCore.pushPermissionResponseAndroid({\n        isGranted: permStatus.receive === \"granted\",\n      });\n      if (permStatus.receive === \"granted\") {\n        MoECapacitorCore.passFcmPushToken({\n          token: fcmToken, //frm token should be added here\n          appId: \"Q5YBYJOT6NU535WZD1JVOIDV\",\n        });\n        MoECapacitorCore.setupNotificationChannelsAndroid();\n        MoECapacitorCore.requestPushPermissionAndroid();\n      } else {\n        MoECapacitorCore.navigateToSettingsAndroid();\n      }\n    }\n  }, [fcmToken]);\n\n  const registerNotifications = async () => {\n    let permStatus = await PushNotifications.checkPermissions();\n\n    if (permStatus.receive === \"prompt\") {\n      permStatus = await PushNotifications.requestPermissions();\n    }\n\n    if (permStatus.receive !== \"granted\") {\n      throw new Error(\"User denied permissions!\");\n    }\n\n    await PushNotifications.register();\n  };\n\n  const getDeliveredNotifications = async () => {\n    const notificationList =\n      await PushNotifications.getDeliveredNotifications();\n    console.log(\"delivered notifications\", notificationList);\n  };\n\n  const enablePushNotifications = () => {\n    if (Capacitor.isNativePlatform()) {\n      addListeners();\n      registerNotifications();\n      getDeliveredNotifications();\n    }\n  };\n\n  return enablePushNotifications;\n};\n\nexport default useNotifications;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}