{"ast":null,"code":"var _s = $RefreshSig$();\n/* eslint-disable import/no-extraneous-dependencies */\nimport { useEffect, useState } from \"react\";\nimport { Capacitor } from \"@capacitor/core\";\nimport { PushNotifications } from \"@capacitor/push-notifications\";\nimport { MoECapacitorCore } from \"capacitor-moengage-core\";\nimport NotificationModule from \"services/pushNotification\";\nimport { EventPathMapping } from \"./eventPathMapping\";\nconst useNotifications = ({\n  velynk_id: velynkId,\n  customerId\n}) => {\n  _s();\n  const [fcmToken, setFcmToken] = useState({});\n  const addListeners = async () => {\n    await PushNotifications.addListener(\"registration\", async token => {\n      setFcmToken(token);\n      console.info(\"Registration token: \", token.value);\n    });\n    await PushNotifications.addListener(\"registrationError\", err => {\n      console.error(\"Registration error: \", err.error);\n    });\n    await PushNotifications.addListener(\"pushNotificationReceived\", notification => {\n      console.log(\"Push notification received: \", notification);\n    });\n    await PushNotifications.addListener(\"pushNotificationActionPerformed\", ({\n      notification\n    }) => {\n      window.open(EventPathMapping(notification.data.event, notification.data));\n    });\n  };\n  useEffect(() => {\n    /**\n     * Handles the pushTokenGenerated event.\n     * @param {import('capacitor-moengage-core').MoEPushTokenData} data - Data received from the event.\n     */\n    const onPushTokenGenerated = data => {\n      console.log(`Received callback 'pushTokenGenerated', data: ${JSON.stringify(data)}`);\n    };\n    const subscription = MoECapacitorCore.addListener(\"pushTokenGenerated\", onPushTokenGenerated);\n    return () => {\n      subscription.remove();\n    };\n  }, []);\n  const sendFCMToken = async () => {\n    await NotificationModule.sendFCMToken({\n      velynkId,\n      customerId,\n      token: fcmToken.value\n    }).catch(err => console.log(err));\n  };\n  useEffect(() => {\n    if (Capacitor.isNativePlatform()) {\n      if (velynkId && fcmToken !== null && fcmToken !== void 0 && fcmToken.value) {\n        sendFCMToken();\n      }\n      const permStatus = PushNotifications.checkPermissions();\n      MoECapacitorCore.pushPermissionResponseAndroid({\n        isGranted: permStatus.receive === \"granted\"\n      });\n      if (permStatus.receive === \"granted\") {\n        MoECapacitorCore.passFcmPushToken({\n          token: fcmToken === null || fcmToken === void 0 ? void 0 : fcmToken.value,\n          appId: \"Q5YBYJOT6NU535WZD1JVOIDV\"\n        });\n        MoECapacitorCore.setupNotificationChannelsAndroid();\n        MoECapacitorCore.requestPushPermissionAndroid();\n      } else {\n        MoECapacitorCore.navigateToSettingsAndroid();\n      }\n    }\n  }, [velynkId, fcmToken === null || fcmToken === void 0 ? void 0 : fcmToken.value]);\n  const registerNotifications = async () => {\n    let permStatus = await PushNotifications.checkPermissions();\n    if (permStatus.receive === \"prompt\") {\n      permStatus = await PushNotifications.requestPermissions();\n    }\n    if (permStatus.receive !== \"granted\") {\n      throw new Error(\"User denied permissions!\");\n    }\n    await PushNotifications.register();\n  };\n  const getDeliveredNotifications = async () => {\n    const notificationList = await PushNotifications.getDeliveredNotifications();\n    console.log(\"delivered notifications\", notificationList);\n  };\n  const enablePushNotifications = () => {\n    if (Capacitor.isNativePlatform()) {\n      addListeners();\n      registerNotifications();\n      getDeliveredNotifications();\n    }\n  };\n  return enablePushNotifications;\n};\n_s(useNotifications, \"gdJRxKRH3NZJEsB7xugHvc8w+v8=\");\nexport default useNotifications;","map":{"version":3,"names":["useEffect","useState","Capacitor","PushNotifications","MoECapacitorCore","NotificationModule","EventPathMapping","useNotifications","velynk_id","velynkId","customerId","_s","fcmToken","setFcmToken","addListeners","addListener","token","console","info","value","err","error","notification","log","window","open","data","event","onPushTokenGenerated","JSON","stringify","subscription","remove","sendFCMToken","catch","isNativePlatform","permStatus","checkPermissions","pushPermissionResponseAndroid","isGranted","receive","passFcmPushToken","appId","setupNotificationChannelsAndroid","requestPushPermissionAndroid","navigateToSettingsAndroid","registerNotifications","requestPermissions","Error","register","getDeliveredNotifications","notificationList","enablePushNotifications"],"sources":["/Users/ruchi/Documents/work/vegrow-repo/moengage-demo-app/src/hooks/useNotifications.js"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nimport { useEffect, useState } from \"react\";\nimport { Capacitor } from \"@capacitor/core\";\nimport { PushNotifications } from \"@capacitor/push-notifications\";\nimport { MoECapacitorCore } from \"capacitor-moengage-core\";\nimport NotificationModule from \"services/pushNotification\";\n\nimport { EventPathMapping } from \"./eventPathMapping\";\n\nconst useNotifications = ({ velynk_id: velynkId, customerId }) => {\n  const [fcmToken, setFcmToken] = useState({});\n  const addListeners = async () => {\n    await PushNotifications.addListener(\"registration\", async (token) => {\n      setFcmToken(token);\n      console.info(\"Registration token: \", token.value);\n    });\n\n    await PushNotifications.addListener(\"registrationError\", (err) => {\n      console.error(\"Registration error: \", err.error);\n    });\n\n    await PushNotifications.addListener(\n      \"pushNotificationReceived\",\n      (notification) => {\n        console.log(\"Push notification received: \", notification);\n      }\n    );\n\n    await PushNotifications.addListener(\n      \"pushNotificationActionPerformed\",\n      ({ notification }) => {\n        window.open(\n          EventPathMapping(notification.data.event, notification.data)\n        );\n      }\n    );\n  };\n\n  useEffect(() => {\n    /**\n     * Handles the pushTokenGenerated event.\n     * @param {import('capacitor-moengage-core').MoEPushTokenData} data - Data received from the event.\n     */\n    const onPushTokenGenerated = (data) => {\n      console.log(\n        `Received callback 'pushTokenGenerated', data: ${JSON.stringify(data)}`\n      );\n    };\n\n    const subscription = MoECapacitorCore.addListener(\n      \"pushTokenGenerated\",\n      onPushTokenGenerated\n    );\n\n    return () => {\n      subscription.remove();\n    };\n  }, []);\n\n  const sendFCMToken = async () => {\n    await NotificationModule.sendFCMToken({\n      velynkId,\n      customerId,\n      token: fcmToken.value,\n    }).catch((err) => console.log(err));\n  };\n\n  useEffect(() => {\n    if (Capacitor.isNativePlatform()) {\n      if (velynkId && fcmToken?.value) {\n        sendFCMToken();\n      }\n\n      const permStatus = PushNotifications.checkPermissions();\n\n      MoECapacitorCore.pushPermissionResponseAndroid({\n        isGranted: permStatus.receive === \"granted\",\n      });\n      if (permStatus.receive === \"granted\") {\n        MoECapacitorCore.passFcmPushToken({\n          token: fcmToken?.value,\n          appId: \"Q5YBYJOT6NU535WZD1JVOIDV\",\n        });\n        MoECapacitorCore.setupNotificationChannelsAndroid();\n        MoECapacitorCore.requestPushPermissionAndroid();\n      } else {\n        MoECapacitorCore.navigateToSettingsAndroid();\n      }\n    }\n  }, [velynkId, fcmToken?.value]);\n\n  const registerNotifications = async () => {\n    let permStatus = await PushNotifications.checkPermissions();\n\n    if (permStatus.receive === \"prompt\") {\n      permStatus = await PushNotifications.requestPermissions();\n    }\n\n    if (permStatus.receive !== \"granted\") {\n      throw new Error(\"User denied permissions!\");\n    }\n\n    await PushNotifications.register();\n  };\n\n  const getDeliveredNotifications = async () => {\n    const notificationList =\n      await PushNotifications.getDeliveredNotifications();\n    console.log(\"delivered notifications\", notificationList);\n  };\n\n  const enablePushNotifications = () => {\n    if (Capacitor.isNativePlatform()) {\n      addListeners();\n      registerNotifications();\n      getDeliveredNotifications();\n    }\n  };\n\n  return enablePushNotifications;\n};\n\nexport default useNotifications;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}